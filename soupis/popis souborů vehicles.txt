# ğŸï¸ MODUL VOZIDLA (MOTORKY) - KOMPLETNÃ STRUKTURA A POPIS

## PÅ˜EHLED MODULU
Modul vozidel je centrÃ¡lnÃ­ evidence vÅ¡ech motorek v servisu. UmoÅ¾Åˆuje kompletnÃ­ sprÃ¡vu motorek, jejich servisnÃ­ historii, technickÃ© Ãºdaje a propojenÃ­ se zÃ¡kaznÃ­ky.

---

## ğŸ“ STRUKTURA SOUBORÅ®

```
modules/vehicles/
â”œâ”€â”€ __init__.py                    # Inicializace modulu
â”œâ”€â”€ module_vehicles.py             # â­ HlavnÃ­ seznam vozidel
â”œâ”€â”€ vehicle_form.py                # FormulÃ¡Å™ pro vytvoÅ™enÃ­/editaci
â”œâ”€â”€ vehicle_detail.py              # Detail vozidla (profesionÃ¡lnÃ­)
â”œâ”€â”€ vehicle_service_history.py     # ServisnÃ­ historie vozidla
â”œâ”€â”€ vehicle_documents.py           # Dokumenty vozidla (STK, emise, TP)
â”œâ”€â”€ vehicle_photos.py              # Fotogalerie vozidla
â”œâ”€â”€ vehicle_reminders.py           # PÅ™ipomÃ­nky (STK, servis, pojiÅ¡tÄ›nÃ­)
â”œâ”€â”€ vehicle_export.py              # Export dat vozidel
â”œâ”€â”€ vehicle_import.py              # Import vozidel (CSV, Excel)
â”œâ”€â”€ vehicle_analytics.py           # Statistiky a analÃ½zy
â””â”€â”€ vehicle_widgets.py             # Dialogy a komponenty
```

---

### **1. `__init__.py`** ğŸ“¦

**ÃšÄel:** InicializaÄnÃ­ soubor modulu

**Obsahuje:**
```python
"""
Modul Vozidla - SprÃ¡va motorek
"""
from .module_vehicles import VehiclesModule
from .vehicle_form import VehicleFormDialog
from .vehicle_detail import VehicleDetailWindow

__all__ = ['VehiclesModule', 'VehicleFormDialog', 'VehicleDetailWindow']
```

---

### **2. `module_vehicles.py`** â­ HLAVNÃ SOUBOR

**ÃšÄel:** HlavnÃ­ vstupnÃ­ bod modulu - seznam vÅ¡ech vozidel

**Obsahuje:**

**HlaviÄka:**
- Titulek "ğŸï¸ Vozidla"
- TlaÄÃ­tko "+ NovÃ© vozidlo" (zelenÃ©)
- TlaÄÃ­tko "ğŸ“¥ Import" (modrÃ©)
- TlaÄÃ­tko "ğŸ“¤ Export" (sekundÃ¡rnÃ­)

**Statistiky - rychlÃ½ pÅ™ehled:**
- Celkem vozidel
- AktivnÃ­ch zÃ¡kaznÃ­kÅ¯
- PlatnÃ¡ STK
- STK expiruje do 30 dnÃ­ (varovÃ¡nÃ­)
- Bez pÅ™iÅ™azenÃ©ho zÃ¡kaznÃ­ka

**Filtry:**
- ğŸ” VyhledÃ¡vÃ¡nÃ­ (SPZ, znaÄka, model, VIN, zÃ¡kaznÃ­k)
- Filtr znaÄky (VÅ¡e, Honda, Yamaha, Suzuki, Kawasaki, BMW, Harley-Davidson...)
- Filtr stavu STK (VÅ¡e, PlatnÃ¡, Expiruje brzy, NeplatnÃ¡, Neuvedeno)
- Filtr zÃ¡kaznÃ­ka (VÅ¡e, S pÅ™iÅ™azenÃ½m, Bez zÃ¡kaznÃ­ka)
- TlaÄÃ­tko ğŸ”„ Reset filtrÅ¯

**Tabulka vozidel:**
- SPZ (registraÄnÃ­ znaÄka)
- ZnaÄka (brand)
- Model
- Rok vÃ½roby
- ZÃ¡kaznÃ­k (jmÃ©no + pÅ™Ã­jmenÃ­)
- Telefon zÃ¡kaznÃ­ka
- Stav km (poslednÃ­ znÃ¡mÃ½)
- STK platnÃ¡ do (barevnÃ© pozadÃ­: zelenÃ¡/oranÅ¾ovÃ¡/ÄervenÃ¡)
- PoslednÃ­ servis (datum)
- PoznÃ¡mka (zkrÃ¡cenÃ¡)
- ID (skrytÃ½ sloupec)

**Funkce:**
- Dvojklik otevÅ™e detail vozidla
- PravÃ© tlaÄÃ­tko - kontextovÃ© menu:
  - ğŸ“– OtevÅ™Ã­t detail
  - âœï¸ Upravit vozidlo
  - ğŸ“‹ KopÃ­rovat SPZ
  - ğŸ“‹ KopÃ­rovat VIN
  - ğŸ‘¤ PÅ™ejÃ­t na zÃ¡kaznÃ­ka
  - ğŸ“‹ Zobrazit zakÃ¡zky
  - ğŸ—“ï¸ NaplÃ¡novat servis
  - ğŸ—‘ï¸ Smazat vozidlo
- SignÃ¡l `vehicle_selected` pro komunikaci
- HromadnÃ½ export vybranÃ½ch vozidel
- BarevnÃ© oznaÄenÃ­ podle stavu STK

**Styly:**
- AlternujÃ­cÃ­ barvy Å™Ã¡dkÅ¯
- BarevnÃ© pozadÃ­ pro STK:
  - ZelenÃ¡: platnÃ¡ vÃ­ce neÅ¾ 30 dnÃ­
  - OranÅ¾ovÃ¡: expiruje do 30 dnÃ­
  - ÄŒervenÃ¡: neplatnÃ¡/proÅ¡lÃ¡
- TuÄnÃ© pÃ­smo pro dÅ¯leÅ¾itÃ© Ãºdaje

---

### **3. `vehicle_form.py`** ğŸ“

**ÃšÄel:** Dialog pro vytvoÅ™enÃ­/editaci vozidla

**Obsahuje:**

**ZÃ¡loÅ¾ka: ZÃ¡kladnÃ­ Ãºdaje**
- SPZ * (registraÄnÃ­ znaÄka, validace formÃ¡tu, automaticky velkÃ¡ pÃ­smena)
- ZnaÄka * (ComboBox s pÅ™ednastavenÃ½mi znaÄkami)
- Model *
- Rok vÃ½roby (SpinBox 1900-2030)
- Barva (ComboBox: ÄŒernÃ¡, BÃ­lÃ¡, ÄŒervenÃ¡, ModrÃ¡, ZelenÃ¡, StÅ™Ã­brnÃ¡, Å edÃ¡, Å½lutÃ¡, OranÅ¾ovÃ¡, JinÃ¡)
- VIN (17 znakÅ¯, validace checksum)

**ZÃ¡loÅ¾ka: TechnickÃ© Ãºdaje**
- Typ motoru (jednovÃ¡lec, dvouvÃ¡lec, ÄtyÅ™vÃ¡lec, V-twin, boxer...)
- Obsah motoru (ccm)
- VÃ½kon (kW)
- Typ paliva (BenzÃ­n, Nafta, Elektro, Hybrid)
- PÅ™evodovka (ManuÃ¡lnÃ­, AutomatickÃ¡, DCT, CVT)
- Pohon (Å˜etÄ›z, KardanovÃ½ hÅ™Ã­del, Å˜emen)
- Hmotnost (kg)

**ZÃ¡loÅ¾ka: Stav vozidla**
- Stav km (aktuÃ¡lnÃ­ stav tachometru)
- STK platnÃ¡ do (DateEdit s kalendÃ¡Å™em)
- Emise platnÃ© do (DateEdit)
- PojiÅ¡tÄ›nÃ­ do (DateEdit)
- Stav vozidla (ComboBox: VÃ½bornÃ½, DobrÃ½, PrÅ¯mÄ›rnÃ½, Å patnÃ½)

**ZÃ¡loÅ¾ka: VlastnÃ­k**
- ZÃ¡kaznÃ­k * (ComboBox s vyhledÃ¡vÃ¡nÃ­m)
- TlaÄÃ­tko "+ NovÃ½ zÃ¡kaznÃ­k" (inline vytvoÅ™enÃ­)
- Info o zÃ¡kaznÃ­kovi (read-only):
  - Telefon
  - Email
  - Adresa

**ZÃ¡loÅ¾ka: PoznÃ¡mky**
- PoznÃ¡mky k vozidlu (TextEdit)
- SpeciÃ¡lnÃ­ poÅ¾adavky
- Historie poÅ¡kozenÃ­

**TlaÄÃ­tka:**
- ZruÅ¡it
- UloÅ¾it
- UloÅ¾it a otevÅ™Ã­t detail (pÅ™i vytvÃ¡Å™enÃ­)

**Validace:**
- SPZ je povinnÃ¡ a unikÃ¡tnÃ­
- VIN mÃ¡ sprÃ¡vnÃ½ formÃ¡t (17 znakÅ¯, kontrolnÃ­ souÄet)
- ZÃ¡kaznÃ­k musÃ­ bÃ½t pÅ™iÅ™azen
- Rok vÃ½roby v rozumnÃ©m rozsahu

---

### **4. `vehicle_detail.py`** ğŸ“– PROFESIONÃLNÃ VERZE

**ÃšÄel:** DetailnÃ­ okno vozidla s kompletnÃ­mi informacemi

**Obsahuje:**

**HornÃ­ liÅ¡ta (action bar):**
- SPZ vozidla (velkÃ©, tuÄnÃ©)
- ZnaÄka + Model
- Badge stavu STK (barevnÃ½)
- TlaÄÃ­tko "âœï¸ Upravit"
- TlaÄÃ­tko "+ NovÃ¡ zakÃ¡zka"
- TlaÄÃ­tko "ğŸ–¨ï¸ Tisk karty"
- TlaÄÃ­tko "ğŸ—‘ï¸ Smazat"

**LevÃ½ panel - zÃ¡loÅ¾ky:**

**ğŸï¸ ZÃ¡loÅ¾ka: ZÃ¡kladnÃ­ informace**

*Sekce: Identifikace*
- SPZ
- VIN
- ZnaÄka
- Model
- Rok vÃ½roby
- Barva

*Sekce: TechnickÃ© Ãºdaje*
- Typ motoru
- Obsah (ccm)
- VÃ½kon (kW/HP)
- Palivo
- PÅ™evodovka
- Pohon
- Hmotnost

*Sekce: Stav*
- AktuÃ¡lnÃ­ stav km
- STK platnÃ¡ do (s varovÃ¡nÃ­m)
- Emise platnÃ© do
- PojiÅ¡tÄ›nÃ­ do
- Stav vozidla

*Sekce: VlastnÃ­k*
- ZÃ¡kaznÃ­k (odkaz na detail)
- Telefon (klikacÃ­ - volÃ¡nÃ­)
- Email (klikacÃ­ - odeslat)
- Adresa

**ğŸ“‹ ZÃ¡loÅ¾ka: ServisnÃ­ historie**
- Widget `VehicleServiceHistoryWidget`
- ChronologickÃ½ pÅ™ehled vÅ¡ech servisÅ¯
- Tabulka:
  - Datum servisu
  - ÄŒÃ­slo zakÃ¡zky (odkaz)
  - Typ servisu
  - Stav km pÅ™i servisu
  - ProvedenÃ© prÃ¡ce
  - Cena celkem
- Filtry: obdobÃ­, typ servisu
- TlaÄÃ­tko "ğŸ“Š Zobrazit statistiky"

**ğŸ“ ZÃ¡loÅ¾ka: Dokumenty**
- Widget `VehicleDocumentsWidget`
- Seznam dokumentÅ¯:
  - ğŸ“œ TechnickÃ½ prÅ¯kaz (TP)
  - ğŸ”§ STK protokol
  - ğŸ’¨ EmisnÃ­ protokol
  - ğŸ“„ PojistnÃ¡ smlouva
  - ğŸ“‹ KupnÃ­ smlouva
  - ğŸ“ OstatnÃ­ dokumenty
- Upload dokumentÅ¯ (PDF, obrÃ¡zky)
- NÃ¡hled dokumentu
- StaÅ¾enÃ­ dokumentu

**ğŸ“· ZÃ¡loÅ¾ka: Fotogalerie**
- Widget `VehiclePhotosWidget`
- MÅ™Ã­Å¾ka s nÃ¡hledy fotek
- Kategorie:
  - CelkovÃ© pohledy
  - Detaily poÅ¡kozenÃ­
  - ServisnÃ­ fotky
  - Dokumentace stavu
- Upload fotek (drag & drop)
- Lightbox pro velkÃ½ nÃ¡hled
- OznaÄenÃ­ hlavnÃ­ fotky

**ğŸ”” ZÃ¡loÅ¾ka: PÅ™ipomÃ­nky**
- Widget `VehicleRemindersWidget`
- Seznam pÅ™ipomÃ­nek:
  - STK - blÃ­Å¾Ã­ se expirace
  - Emise - blÃ­Å¾Ã­ se expirace
  - PojiÅ¡tÄ›nÃ­ - blÃ­Å¾Ã­ se expirace
  - PlÃ¡novanÃ½ servis
  - VlastnÃ­ pÅ™ipomÃ­nky
- BarevnÃ© oznaÄenÃ­ priority
- AutomatickÃ© notifikace

**ğŸ“ ZÃ¡loÅ¾ka: PoznÃ¡mky**
- PoznÃ¡mky k vozidlu (editovatelnÃ©)
- SpeciÃ¡lnÃ­ poÅ¾adavky zÃ¡kaznÃ­ka
- Historie poÅ¡kozenÃ­/havÃ¡riÃ­
- DoporuÄenÃ­ pro pÅ™Ã­Å¡tÃ­ servis

**PravÃ½ panel - rychlÃ© akce:**

*Sekce: ZakÃ¡zky*
- Seznam poslednÃ­ch 5 zakÃ¡zek
- TlaÄÃ­tko "Zobrazit vÅ¡echny"
- TlaÄÃ­tko "+ NovÃ¡ zakÃ¡zka"

*Sekce: Statistiky*
- Celkem zakÃ¡zek
- CelkovÃ¡ Ãºtrata
- PrÅ¯mÄ›rnÃ¡ cena servisu
- PoslednÃ­ servis pÅ™ed X dny

*Sekce: UpozornÄ›nÃ­*
- âš ï¸ STK expiruje za X dnÃ­
- âš ï¸ Emise expirujÃ­ za X dnÃ­
- âš ï¸ PojiÅ¡tÄ›nÃ­ vyprÅ¡Ã­ za X dnÃ­
- â„¹ï¸ DoporuÄenÃ½ servis za X km

---

### **5. `vehicle_service_history.py`** ğŸ“‹

**ÃšÄel:** Historie vÅ¡ech servisÅ¯ vozidla

**Obsahuje:**

**TÅ™Ã­da `VehicleServiceHistoryWidget`:**

**HlaviÄka:**
- Titulek "ğŸ“‹ ServisnÃ­ historie"
- Filtr obdobÃ­ (VÅ¡e, PoslednÃ­ rok, PoslednÃ­ 2 roky)
- Filtr typu (VÅ¡e, PravidelnÃ½ servis, Oprava, STK, HavÃ¡rie)
- TlaÄÃ­tko "ğŸ“Š Statistiky"
- TlaÄÃ­tko "ğŸ“¤ Export"

**Tabulka historie:**
- Datum
- ÄŒÃ­slo zakÃ¡zky (odkaz)
- Typ servisu
- Stav km
- Popis pracÃ­ (zkrÃ¡cenÄ›)
- PouÅ¾itÃ© dÃ­ly (poÄet)
- Cena bez DPH
- Cena s DPH
- Mechanik

**DetailnÃ­ pohled:**
- KliknutÃ­m na Å™Ã¡dek zobrazÃ­ detail
- KompletnÃ­ seznam poloÅ¾ek
- Fotodokumentace
- PoznÃ¡mky mechanika

**Statistiky:**
- PrÅ¯mÄ›rnÃ¡ cena servisu
- NejÄastÄ›jÅ¡Ã­ opravy
- CelkovÃ© nÃ¡klady za obdobÃ­
- Graf nÃ¡kladÅ¯ v Äase

**Funkce:**
- `load_history()` - naÄtenÃ­ historie z DB
- `filter_by_period()` - filtrovÃ¡nÃ­ podle obdobÃ­
- `export_history()` - export do PDF/Excel
- `calculate_statistics()` - vÃ½poÄet statistik

---

### **6. `vehicle_documents.py`** ğŸ“

**ÃšÄel:** SprÃ¡va dokumentÅ¯ vozidla

**Obsahuje:**

**TÅ™Ã­da `VehicleDocumentsWidget`:**

**Kategorie dokumentÅ¯:**
- ğŸ“œ TechnickÃ½ prÅ¯kaz (TP)
- ğŸ”§ STK protokoly
- ğŸ’¨ EmisnÃ­ protokoly
- ğŸ“„ PojistnÃ© smlouvy
- ğŸ“‹ KupnÃ­ smlouvy
- ğŸ“ ServisnÃ­ kniha
- ğŸ“Š OstatnÃ­ dokumenty

**Tabulka dokumentÅ¯:**
- Typ dokumentu
- NÃ¡zev souboru
- Datum nahrÃ¡nÃ­
- Platnost do
- Velikost
- Akce (nÃ¡hled, staÅ¾enÃ­, smazÃ¡nÃ­)

**Funkce:**
- `upload_document()` - nahrÃ¡nÃ­ dokumentu
- `preview_document()` - nÃ¡hled v aplikaci
- `download_document()` - staÅ¾enÃ­
- `delete_document()` - smazÃ¡nÃ­
- `check_expiration()` - kontrola platnosti

**PodporovanÃ© formÃ¡ty:**
- PDF
- JPEG, PNG
- Word (DOC, DOCX)
- Excel (XLS, XLSX)

**AutomatickÃ© upozornÄ›nÃ­:**
- STK/Emise/PojiÅ¡tÄ›nÃ­ - pÅ™ed expiracÃ­

---

### **7. `vehicle_photos.py`** ğŸ“·

**ÃšÄel:** Fotogalerie vozidla

**Obsahuje:**

**TÅ™Ã­da `VehiclePhotosWidget`:**

**MÅ™Ã­Å¾ka fotek:**
- Thumbnail nÃ¡hledy (150x150 px)
- OznaÄenÃ­ hlavnÃ­ fotky (hvÄ›zdiÄka)
- Kategorie (odznak)
- Datum poÅ™Ã­zenÃ­

**Kategorie:**
- ğŸï¸ CelkovÃ© pohledy
- ğŸ”§ Detaily poÅ¡kozenÃ­
- ğŸ› ï¸ ServisnÃ­ fotky
- ğŸ“‹ Dokumentace stavu
- ğŸ“… PÅ™ed/Po servisu

**Funkce:**
- `add_photo()` - pÅ™idÃ¡nÃ­ fotky (dialog nebo drag & drop)
- `remove_photo()` - smazÃ¡nÃ­ fotky
- `set_main_photo()` - nastavenÃ­ hlavnÃ­ fotky
- `open_lightbox()` - velkÃ½ nÃ¡hled
- `export_gallery()` - export galerie

**Lightbox:**
- VelkÃ½ nÃ¡hled fotky
- Navigace Å¡ipkami
- Informace o fotce (datum, kategorie, poznÃ¡mka)
- StaÅ¾enÃ­ plnÃ© velikosti

**Metadata:**
- Datum poÅ™Ã­zenÃ­
- Kategorie
- PoznÃ¡mka k fotce
- PoÅ™adÃ­ zobrazenÃ­

---

### **8. `vehicle_reminders.py`** ğŸ””

**ÃšÄel:** SystÃ©m pÅ™ipomÃ­nek pro vozidlo

**Obsahuje:**

**TÅ™Ã­da `VehicleRemindersWidget`:**

**Typy pÅ™ipomÃ­nek:**
- ğŸ”§ STK - blÃ­Å¾Ã­ se expirace
- ğŸ’¨ Emise - blÃ­Å¾Ã­ se expirace
- ğŸ“„ PojiÅ¡tÄ›nÃ­ - blÃ­Å¾Ã­ se expirace
- ğŸ› ï¸ PlÃ¡novanÃ½ servis (po X km)
- ğŸ”„ VÃ½mÄ›na oleje (po X km)
- âš™ï¸ VÃ½mÄ›na Å™etÄ›zu/rozvodÅ¯
- ğŸ“… VlastnÃ­ pÅ™ipomÃ­nka

**Tabulka pÅ™ipomÃ­nek:**
- Typ pÅ™ipomÃ­nky
- Popis
- Datum/km
- ZbÃ½vÃ¡ dnÃ­/km
- Priorita (barevnÃ© oznaÄenÃ­)
- Stav (aktivnÃ­/splnÄ›no/ignorovÃ¡no)

**BarevnÃ© kÃ³dovÃ¡nÃ­:**
- ğŸ”´ ÄŒervenÃ¡: kritickÃ© (do 7 dnÃ­)
- ğŸŸ  OranÅ¾ovÃ¡: brzy (do 30 dnÃ­)
- ğŸŸ¡ Å½lutÃ¡: plÃ¡novanÃ© (do 90 dnÃ­)
- ğŸŸ¢ ZelenÃ¡: v poÅ™Ã¡dku

**Funkce:**
- `add_reminder()` - pÅ™idÃ¡nÃ­ pÅ™ipomÃ­nky
- `mark_completed()` - oznaÄenÃ­ jako splnÄ›no
- `snooze_reminder()` - odloÅ¾enÃ­
- `delete_reminder()` - smazÃ¡nÃ­
- `check_automatic()` - automatickÃ¡ kontrola STK/emisÃ­/pojiÅ¡tÄ›nÃ­

**Notifikace:**
- Email zÃ¡kaznÃ­kovi
- SMS upozornÄ›nÃ­ (volitelnÄ›)
- Push notifikace v aplikaci
- Export do kalendÃ¡Å™e

---

### **9. `vehicle_export.py`** ğŸ“¤

**ÃšÄel:** Export dat vozidel

**Obsahuje:**

**TÅ™Ã­da `VehicleExporter`:**

**Typy exportÅ¯:**
- ğŸ“„ Karta vozidla (PDF)
- ğŸ“‹ ServisnÃ­ kniha (PDF)
- ğŸ“Š Seznam vozidel (Excel)
- ğŸ“ KompletnÃ­ export (ZIP)

**`export_vehicle_card()`:**
- ProfesionÃ¡lnÃ­ PDF karta vozidla
- ZÃ¡kladnÃ­ Ãºdaje
- TechnickÃ© specifikace
- Fotka vozidla
- QR kÃ³d s VIN
- Kontakt na servis

**`export_service_book()`:**
- PDF servisnÃ­ kniha
- ChronologickÃ½ pÅ™ehled servisÅ¯
- ProvedenÃ© prÃ¡ce
- PouÅ¾itÃ© dÃ­ly
- DoporuÄenÃ­

**`export_vehicle_list()`:**
- Excel s vÃ­ce listy:
  - Seznam vozidel
  - TechnickÃ© Ãºdaje
  - Stav STK/emisÃ­
  - ZÃ¡kaznÃ­ci

**`export_complete()`:**
- ZIP archiv obsahujÃ­cÃ­:
  - Karta vozidla (PDF)
  - ServisnÃ­ historie (PDF)
  - Dokumenty
  - Fotogalerie
  - Data (JSON)

---

### **10. `vehicle_import.py`** ğŸ“¥

**ÃšÄel:** Import vozidel z externÃ­ch zdrojÅ¯

**Obsahuje:**

**TÅ™Ã­da `VehicleImporter`:**

**PodporovanÃ© formÃ¡ty:**
- CSV (oddÄ›lenÃ© ÄÃ¡rkou/stÅ™ednÃ­kem)
- Excel (XLS, XLSX)
- JSON

**Dialog importu:**
1. VÃ½bÄ›r souboru
2. NÃ¡hled dat (prvnÃ­ch 10 Å™Ã¡dkÅ¯)
3. MapovÃ¡nÃ­ sloupcÅ¯:
   - SPZ â†’ license_plate
   - ZnaÄka â†’ brand
   - Model â†’ model
   - Rok â†’ year
   - VIN â†’ vin
   - ZÃ¡kaznÃ­k â†’ customer_id (vyhledÃ¡nÃ­/vytvoÅ™enÃ­)
4. Validace dat
5. Import s progress barem
6. Souhrn (importovÃ¡no/chyby/pÅ™eskoÄeno)

**Funkce:**
- `preview_file()` - nÃ¡hled dat
- `map_columns()` - mapovÃ¡nÃ­ sloupcÅ¯
- `validate_data()` - validace (SPZ, VIN, rok)
- `import_vehicles()` - samotnÃ½ import
- `create_report()` - report importu

**ChovÃ¡nÃ­ pÅ™i konfliktech:**
- PÅ™eskoÄit existujÃ­cÃ­
- Aktualizovat existujÃ­cÃ­
- VytvoÅ™it duplikÃ¡t

---

### **11. `vehicle_analytics.py`** ğŸ“Š

**ÃšÄel:** Statistiky a analÃ½zy vozidel

**Obsahuje:**

**Filtry:**
- ObdobÃ­ (Tento mÄ›sÃ­c, Tento rok, VÅ¡e)
- ZnaÄka (VÅ¡e, Honda, Yamaha...)
- Rok vÃ½roby (rozsah)

**StatistickÃ© boxy:**
- ğŸï¸ Celkem vozidel
- âœ… PlatnÃ¡ STK
- âš ï¸ STK expiruje brzy
- âŒ NeplatnÃ¡ STK
- ğŸ’° PrÅ¯mÄ›rnÃ¡ Ãºtrata/vozidlo
- ğŸ”§ PrÅ¯mÄ›rnÃ½ poÄet servisÅ¯

**Grafy a pÅ™ehledy:**

*Podle znaÄky:*
- KolÃ¡ÄovÃ½ graf znaÄek
- Tabulka: ZnaÄka, PoÄet, Procento, CelkovÃ¡ Ãºtrata

*Podle roku vÃ½roby:*
- SloupcovÃ½ graf
- RozloÅ¾enÃ­ stÃ¡Å™Ã­ vozidel

*Podle typu servisu:*
- NejÄastÄ›jÅ¡Ã­ opravy
- SezÃ³nnÃ­ trendy

*FinanÄnÃ­ pÅ™ehledy:*
- Top 10 vozidel podle Ãºtraty
- PrÅ¯mÄ›rnÃ¡ cena servisu podle znaÄky
- Trend nÃ¡kladÅ¯ v Äase

**Export:**
- PDF report
- Excel s grafy

---

### **12. `vehicle_widgets.py`** ğŸ§©

**ÃšÄel:** PomocnÃ© dialogy a komponenty

**Obsahuje:**

**`VehicleDialog`:**
- JednoduchÃ½ dialog pro rychlou editaci
- PouÅ¾Ã­vanÃ½ z jinÃ½ch modulÅ¯ (zakÃ¡zky)
- ZÃ¡kladnÃ­ Ãºdaje + zÃ¡kaznÃ­k
- RychlÃ© uloÅ¾enÃ­

**`VehicleSearchDialog`:**
- VyhledÃ¡vÃ¡nÃ­ vozidla
- FiltrovÃ¡nÃ­ podle SPZ, VIN, zÃ¡kaznÃ­ka
- VÃ½bÄ›r ze seznamu
- NÃ¡hled zÃ¡kladnÃ­ch ÃºdajÅ¯

**`VehicleQuickAddDialog`:**
- RychlÃ© pÅ™idÃ¡nÃ­ vozidla
- MinimÃ¡lnÃ­ Ãºdaje (SPZ, znaÄka, model, zÃ¡kaznÃ­k)
- Pro inline vytvoÅ™enÃ­ z jinÃ½ch modulÅ¯

**`STKReminderWidget`:**
- Widget pro zobrazenÃ­ stavu STK
- BarevnÃ½ indikÃ¡tor
- ZbÃ½vajÃ­cÃ­ dny
- TlaÄÃ­tko "NaplÃ¡novat STK"

**`VehicleCard`:**
- Karta vozidla pro nÃ¡hledy
- Fotka (pokud existuje)
- SPZ, znaÄka, model
- ZÃ¡kaznÃ­k
- Stav STK badge

**`VehicleSelector`:**
- ComboBox s vyhledÃ¡vÃ¡nÃ­m
- Autocomplete podle SPZ/znaÄky/modelu
- NÃ¡hled vybranÃ©ho vozidla

**`MileageUpdateDialog`:**
- Dialog pro aktualizaci stavu km
- PoslednÃ­ znÃ¡mÃ½ stav
- NovÃ½ stav (validace - musÃ­ bÃ½t vÄ›tÅ¡Ã­)
- Datum aktualizace
- PoznÃ¡mka

---

## ğŸ¨ VIZUALIZACE STRUKTURY

```
ğŸï¸ MODUL VOZIDLA
â”‚
â”œâ”€ ğŸ“‹ Seznam vozidel (module_vehicles)
â”‚  â”œâ”€ ğŸ” VyhledÃ¡vÃ¡nÃ­ a filtry
â”‚  â”œâ”€ ğŸ“Š Statistiky (celkem, STK, zÃ¡kaznÃ­ci)
â”‚  â”œâ”€ ğŸ“‘ Tabulka vozidel
â”‚  â”œâ”€ â• NovÃ© vozidlo / Import / Export
â”‚  â””â”€ ğŸ–±ï¸ KontextovÃ© menu
â”‚
â”œâ”€ ğŸ“ FormulÃ¡Å™ vozidla (vehicle_form)
â”‚  â”œâ”€ ğŸï¸ ZÃ¡kladnÃ­ Ãºdaje (SPZ, znaÄka, model, VIN)
â”‚  â”œâ”€ âš™ï¸ TechnickÃ© Ãºdaje (motor, vÃ½kon, palivo)
â”‚  â”œâ”€ ğŸ“Š Stav (km, STK, emise, pojiÅ¡tÄ›nÃ­)
â”‚  â”œâ”€ ğŸ‘¤ VlastnÃ­k (zÃ¡kaznÃ­k)
â”‚  â””â”€ ğŸ“ PoznÃ¡mky
â”‚
â”œâ”€ ğŸ“– Detail vozidla (vehicle_detail)
â”‚  â”œâ”€ ğŸï¸ ZÃ¡kladnÃ­ informace
â”‚  â”‚  â”œâ”€ ğŸ”– Identifikace (SPZ, VIN)
â”‚  â”‚  â”œâ”€ âš™ï¸ TechnickÃ© Ãºdaje
â”‚  â”‚  â”œâ”€ ğŸ“Š Stav vozidla
â”‚  â”‚  â””â”€ ğŸ‘¤ VlastnÃ­k (proklik)
â”‚  â”‚
â”‚  â”œâ”€ ğŸ“‹ ServisnÃ­ historie
â”‚  â”‚  â”œâ”€ ğŸ“… ChronologickÃ½ pÅ™ehled
â”‚  â”‚  â”œâ”€ ğŸ”§ ProvedenÃ© prÃ¡ce
â”‚  â”‚  â””â”€ ğŸ’° NÃ¡klady
â”‚  â”‚
â”‚  â”œâ”€ ğŸ“ Dokumenty
â”‚  â”‚  â”œâ”€ ğŸ“œ TP, STK, Emise
â”‚  â”‚  â”œâ”€ ğŸ“„ Pojistky
â”‚  â”‚  â””â”€ ğŸ“¤ Upload/Download
â”‚  â”‚
â”‚  â”œâ”€ ğŸ“· Fotogalerie
â”‚  â”‚  â”œâ”€ ğŸ–¼ï¸ NÃ¡hledy
â”‚  â”‚  â”œâ”€ ğŸ“‚ Kategorie
â”‚  â”‚  â””â”€ ğŸ” Lightbox
â”‚  â”‚
â”‚  â”œâ”€ ğŸ”” PÅ™ipomÃ­nky
â”‚  â”‚  â”œâ”€ ğŸ”§ STK/Emise/PojiÅ¡tÄ›nÃ­
â”‚  â”‚  â”œâ”€ ğŸ› ï¸ PlÃ¡novanÃ© servisy
â”‚  â”‚  â””â”€ ğŸ“§ Notifikace
â”‚  â”‚
â”‚  â””â”€ ğŸ“ PoznÃ¡mky
â”‚     â””â”€ âœï¸ EditovatelnÃ© poznÃ¡mky
â”‚
â”œâ”€ ğŸ“¤ Export (vehicle_export)
â”‚  â”œâ”€ ğŸ“„ Karta vozidla (PDF)
â”‚  â”œâ”€ ğŸ“‹ ServisnÃ­ kniha (PDF)
â”‚  â”œâ”€ ğŸ“Š Seznam vozidel (Excel)
â”‚  â””â”€ ğŸ“ KompletnÃ­ export (ZIP)
â”‚
â”œâ”€ ğŸ“¥ Import (vehicle_import)
â”‚  â”œâ”€ ğŸ“„ CSV import
â”‚  â”œâ”€ ğŸ“Š Excel import
â”‚  â”œâ”€ ğŸ”„ MapovÃ¡nÃ­ sloupcÅ¯
â”‚  â””â”€ âœ… Validace dat
â”‚
â”œâ”€ ğŸ“Š Analytiky (vehicle_analytics)
â”‚  â”œâ”€ ğŸ“ˆ StatistickÃ© boxy
â”‚  â”œâ”€ ğŸ¥§ Grafy (znaÄky, roky)
â”‚  â”œâ”€ ğŸ’° FinanÄnÃ­ pÅ™ehledy
â”‚  â””â”€ ğŸ“¤ Export reportÅ¯
â”‚
â””â”€ ğŸ§© PomocnÃ© widgety (vehicle_widgets)
   â”œâ”€ ğŸ” VyhledÃ¡vacÃ­ dialog
   â”œâ”€ â• Quick add dialog
   â”œâ”€ ğŸ”” STK reminder widget
   â”œâ”€ ğŸï¸ Vehicle card
   â””â”€ ğŸ“ Mileage update dialog
```

---

## ğŸ”— VAZBY NA OSTATNÃ MODULY

**ZÃ¡visÃ­ na:**
- `config` - barvy, VEHICLE_BRANDS, FUEL_TYPES, VEHICLE_COLORS
- `database_manager` - pÅ™Ã­stup k databÃ¡zi (db)
- `module_customers` - CustomerDialog, CustomerSelector

**PouÅ¾Ã­vÃ¡ ho:**
- `module_orders` - vÃ½bÄ›r vozidla pro zakÃ¡zku
- `module_customers` - seznam vozidel zÃ¡kaznÃ­ka

**DatabÃ¡zovÃ© tabulky:**
- `vehicles` - hlavnÃ­ tabulka vozidel
- `customers` - vlastnÃ­ci vozidel
- `orders` - zakÃ¡zky (pro historii)
- `order_items` - poloÅ¾ky zakÃ¡zek
- `vehicle_documents` - dokumenty vozidel
- `vehicle_photos` - fotky vozidel
- `vehicle_reminders` - pÅ™ipomÃ­nky

**SignÃ¡ly:**
- `vehicle_selected` - vÃ½bÄ›r vozidla
- `vehicle_updated` - zmÄ›na vozidla
- `vehicle_created` - novÃ© vozidlo
- `reminder_triggered` - aktivace pÅ™ipomÃ­nky

---

## ğŸ’¾ DATABÃZOVÃ STRUKTURA

```sql
CREATE TABLE vehicles (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    customer_id INTEGER,
    license_plate TEXT UNIQUE NOT NULL,
    brand TEXT NOT NULL,
    model TEXT NOT NULL,
    year INTEGER,
    color TEXT,
    vin TEXT,
    engine_type TEXT,
    engine_capacity INTEGER,
    power_kw REAL,
    fuel_type TEXT,
    transmission TEXT,
    drive_type TEXT,
    weight REAL,
    mileage INTEGER,
    stk_valid_until DATE,
    emissions_valid_until DATE,
    insurance_valid_until DATE,
    vehicle_condition TEXT,
    notes TEXT,
    main_photo_id INTEGER,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (customer_id) REFERENCES customers(id)
);

CREATE TABLE vehicle_documents (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    vehicle_id INTEGER NOT NULL,
    document_type TEXT NOT NULL,
    file_name TEXT NOT NULL,
    file_path TEXT NOT NULL,
    file_size INTEGER,
    valid_until DATE,
    uploaded_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    notes TEXT,
    FOREIGN KEY (vehicle_id) REFERENCES vehicles(id)
);

CREATE TABLE vehicle_photos (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    vehicle_id INTEGER NOT NULL,
    file_name TEXT NOT NULL,
    file_path TEXT NOT NULL,
    category TEXT,
    is_main BOOLEAN DEFAULT 0,
    taken_at DATETIME,
    uploaded_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    notes TEXT,
    sort_order INTEGER DEFAULT 0,
    FOREIGN KEY (vehicle_id) REFERENCES vehicles(id)
);

CREATE TABLE vehicle_reminders (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    vehicle_id INTEGER NOT NULL,
    reminder_type TEXT NOT NULL,
    description TEXT,
    due_date DATE,
    due_mileage INTEGER,
    priority TEXT DEFAULT 'normal',
    status TEXT DEFAULT 'active',
    notified BOOLEAN DEFAULT 0,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    completed_at DATETIME,
    FOREIGN KEY (vehicle_id) REFERENCES vehicles(id)
);
```

---

## ğŸ’¡ KLÃÄŒOVÃ‰ FUNKCE

1. **UnikÃ¡tnÃ­ SPZ** - validace a automatickÃ© velkÃ© pÃ­smeny
2. **Validace VIN** - kontrola formÃ¡tu a checksum
3. **AutomatickÃ© propojenÃ­ se zÃ¡kaznÃ­kem** - vlastnÃ­k vozidla
4. **ServisnÃ­ historie** - kompletnÃ­ pÅ™ehled vÅ¡ech servisÅ¯
5. **SprÃ¡va dokumentÅ¯** - STK, emise, pojiÅ¡tÄ›nÃ­, TP
6. **Fotogalerie** - dokumentace stavu vozidla
7. **SystÃ©m pÅ™ipomÃ­nek** - automatickÃ© upozornÄ›nÃ­ na STK/emise/pojiÅ¡tÄ›nÃ­
8. **Export karty vozidla** - profesionÃ¡lnÃ­ PDF
9. **Import vozidel** - hromadnÃ© pÅ™idÃ¡nÃ­ z CSV/Excel
10. **Analytiky** - statistiky podle znaÄek, stÃ¡Å™Ã­, nÃ¡kladÅ¯
11. **BarevnÃ© kÃ³dovÃ¡nÃ­ STK** - okamÅ¾itÃ½ pÅ™ehled o stavu
12. **Proklik na zÃ¡kaznÃ­ka** - rychlÃ¡ navigace
13. **Proklik na zakÃ¡zky** - zobrazenÃ­ historie servisu
14. **Aktualizace stavu km** - sledovÃ¡nÃ­ nÃ¡jezdu

---

## ğŸ¯ PRODUKÄŒNÃ POÅ½ADAVKY

1. **VÃ½kon:**
   - Lazy loading pro velkÃ© seznamy
   - Caching nÃ¡hledÅ¯ fotek
   - IndexovÃ¡nÃ­ v DB (SPZ, VIN, customer_id)

2. **BezpeÄnost:**
   - Validace vÅ¡ech vstupÅ¯
   - SQL injection ochrana (parametrizovanÃ© dotazy)
   - BezpeÄnÃ© uklÃ¡dÃ¡nÃ­ souborÅ¯

3. **UX:**
   - ResponzivnÃ­ design
   - KlÃ¡vesovÃ© zkratky
   - Drag & drop pro fotky/dokumenty
   - Autocomplete pro vyhledÃ¡vÃ¡nÃ­

4. **Integrace:**
   - Export do ÃºÄetnÃ­ch systÃ©mÅ¯
   - Email notifikace
   - SMS brÃ¡na (volitelnÄ›)
   - KalendÃ¡Å™ (ICS export)

5. **ZÃ¡lohovÃ¡nÃ­:**
   - AutomatickÃ© zÃ¡lohovÃ¡nÃ­ dokumentÅ¯
   - Export kompletnÃ­ch dat
   - Obnova ze zÃ¡lohy
