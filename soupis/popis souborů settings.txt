# âš™ï¸ MODUL NASTAVENÃ - KOMPLETNÃ STRUKTURA A POPIS

## PÅ˜EHLED MODULU
Modul nastavenÃ­ je centrÃ¡lnÃ­ konfiguraÄnÃ­ centrum celÃ©ho systÃ©mu Motoservis DMS. UmoÅ¾Åˆuje kompletnÃ­ nastavenÃ­ aplikace, firemnÃ­ch ÃºdajÅ¯, uÅ¾ivatelÅ¯, oprÃ¡vnÄ›nÃ­, zÃ¡lohovÃ¡nÃ­ a pÅ™izpÅ¯sobenÃ­ systÃ©mu.

---

## ğŸ“ STRUKTURA SOUBORÅ®

```
modules/settings/
â”œâ”€â”€ __init__.py                    # Inicializace modulu
â”œâ”€â”€ module_settings.py             # â­ HlavnÃ­ nastavenÃ­ s navigacÃ­
â”œâ”€â”€ settings_company.py            # FiremnÃ­ Ãºdaje
â”œâ”€â”€ settings_users.py              # SprÃ¡va uÅ¾ivatelÅ¯
â”œâ”€â”€ settings_permissions.py        # OprÃ¡vnÄ›nÃ­ a role
â”œâ”€â”€ settings_orders.py             # NastavenÃ­ zakÃ¡zek
â”œâ”€â”€ settings_invoicing.py          # Fakturace a ÄÃ­selnÃ© Å™ady
â”œâ”€â”€ settings_templates.py          # Å ablony dokumentÅ¯
â”œâ”€â”€ settings_email.py              # Email a notifikace
â”œâ”€â”€ settings_backup.py             # ZÃ¡lohovÃ¡nÃ­ a obnova - moÅ¾nost nastavit si zÃ¡lohu do pc a tÅ™eba na NAS server
â”œâ”€â”€ settings_database.py           # SprÃ¡va databÃ¡ze
â”œâ”€â”€ settings_appearance.py         # Vzhled a pÅ™izpÅ¯sobenÃ­
â”œâ”€â”€ settings_integrations.py       # Integrace (ARES, SMS, API)
â”œâ”€â”€ settings_license.py            # Licence a aktivace
â””â”€â”€ settings_widgets.py            # Dialogy a komponenty
```

---

### **1. `__init__.py`** ğŸ“¦

**ÃšÄel:** InicializaÄnÃ­ soubor modulu

**Obsahuje:**
```python
"""
Modul NastavenÃ­ - Konfigurace systÃ©mu
"""
from .module_settings import SettingsModule

__all__ = ['SettingsModule']
```

---

### **2. `module_settings.py`** â­ HLAVNÃ SOUBOR

**ÃšÄel:** HlavnÃ­ vstupnÃ­ bod s navigacÃ­ mezi sekcemi

**Obsahuje:**

**Layout:**
- LevÃ½ panel - navigaÄnÃ­ menu
- PravÃ½ panel - obsah vybranÃ© sekce

**NavigaÄnÃ­ menu:**
- ğŸ¢ **FiremnÃ­ Ãºdaje**
- ğŸ‘¥ **UÅ¾ivatelÃ©**
- ğŸ” **OprÃ¡vnÄ›nÃ­ a role**
- ğŸ“‹ **ZakÃ¡zky**
- ğŸ§¾ **Fakturace**
- ğŸ“„ **Å ablony dokumentÅ¯**
- ğŸ“§ **Email a notifikace**
- ğŸ’¾ **ZÃ¡lohovÃ¡nÃ­**
- ğŸ—„ï¸ **DatabÃ¡ze**
- ğŸ¨ **Vzhled**
- ğŸ”— **Integrace**
- ğŸ“œ **Licence**

**HlaviÄka:**
- Titulek "âš™ï¸ NastavenÃ­"
- VyhledÃ¡vÃ¡nÃ­ v nastavenÃ­
- TlaÄÃ­tko "ğŸ“– NÃ¡povÄ›da"
- TlaÄÃ­tko "ğŸ”„ Obnovit vÃ½chozÃ­"

**Funkce:**
- `switch_section()` - pÅ™epnutÃ­ sekce
- `search_settings()` - vyhledÃ¡vÃ¡nÃ­
- `reset_to_defaults()` - obnovenÃ­ vÃ½chozÃ­ch
- `export_settings()` - export nastavenÃ­
- `import_settings()` - import nastavenÃ­

---

### **3. `settings_company.py`** ğŸ¢

**ÃšÄel:** NastavenÃ­ firemnÃ­ch ÃºdajÅ¯

**Obsahuje:**

**Sekce: ZÃ¡kladnÃ­ Ãºdaje**
- NÃ¡zev firmy *
- IÄŒO *
- DIÄŒ
- PrÃ¡vnÃ­ forma (s.r.o., a.s., OSVÄŒ...)
- Datum zaloÅ¾enÃ­
- Registrace (OR, Å½L)

**Sekce: KontaktnÃ­ Ãºdaje**
- Adresa sÃ­dla *
  - Ulice
  - MÄ›sto
  - PSÄŒ
  - Kraj
  - ZemÄ›
- Provozovna (pokud jinÃ¡)
- Telefon *
- Email *
- Web
- Fax (volitelnÄ›)

**Sekce: BankovnÃ­ spojenÃ­**
- ÄŒÃ­slo ÃºÄtu *
- KÃ³d banky
- IBAN
- BIC/SWIFT
- NÃ¡zev banky

**Sekce: Logo a branding**
- Logo firmy (upload obrÃ¡zku)
  - NÃ¡hled
  - DoporuÄenÃ© rozmÄ›ry
  - FormÃ¡ty: PNG, JPG, SVG
- Barvy firmy
  - PrimÃ¡rnÃ­ barva
  - SekundÃ¡rnÃ­ barva
- RazÃ­tko (upload)
- Podpis (upload)

**Sekce: ProvoznÃ­ Ãºdaje**
- OtevÃ­racÃ­ doba:
  - PondÄ›lÃ­: 7:00-16:00
  - ÃšterÃ½: 7:00-16:00
  - ...
  - Sobota: 8:00-12:00
  - NedÄ›le: ZavÅ™eno
- SvÃ¡tky (import CZ svÃ¡tkÅ¯)
- Kapacita servisu (poÄet stanoviÅ¡Å¥)
- MaximÃ¡lnÃ­ poÄet zakÃ¡zek/den

**TlaÄÃ­tka:**
- ğŸ’¾ UloÅ¾it zmÄ›ny
- ğŸ”„ Obnovit
- ğŸ“¤ Exportovat Ãºdaje

**Validace:**
- IÄŒO 8 ÄÃ­slic
- DIÄŒ formÃ¡t CZxxxxxxxx
- IBAN validace
- PovinnÃ¡ pole

---

### **4. `settings_users.py`** ğŸ‘¥

**ÃšÄel:** SprÃ¡va uÅ¾ivatelÅ¯ systÃ©mu

**Obsahuje:**

**Tabulka uÅ¾ivatelÅ¯:**
- JmÃ©no a pÅ™Ã­jmenÃ­
- UÅ¾ivatelskÃ© jmÃ©no (login)
- Email
- Role (Admin, Mechanik, Recepce, ÃšÄetnÃ­)
- PoslednÃ­ pÅ™ihlÃ¡Å¡enÃ­
- Stav (AktivnÃ­/NeaktivnÃ­)
- Akce (upravit, smazat, resetovat heslo)

**TlaÄÃ­tka:**
- â• NovÃ½ uÅ¾ivatel
- ğŸ“¤ Export uÅ¾ivatelÅ¯
- ğŸ”„ Obnovit

**Dialog novÃ©ho uÅ¾ivatele:**

*ZÃ¡kladnÃ­ Ãºdaje:*
- JmÃ©no *
- PÅ™Ã­jmenÃ­ *
- Email *
- Telefon

*PÅ™ihlaÅ¡ovacÃ­ Ãºdaje:*
- UÅ¾ivatelskÃ© jmÃ©no * (unikÃ¡tnÃ­)
- Heslo * (min. 8 znakÅ¯, velkÃ©/malÃ©, ÄÃ­slo)
- Potvrdit heslo *
- ZmÄ›nit heslo pÅ™i prvnÃ­m pÅ™ihlÃ¡Å¡enÃ­ (checkbox)

*Role a oprÃ¡vnÄ›nÃ­:*
- Role (ComboBox):
  - AdministrÃ¡tor
  - ManaÅ¾er
  - Mechanik
  - Recepce
  - ÃšÄetnÃ­
  - Sklad
- AktivnÃ­ (checkbox)

*Notifikace:*
- Email notifikace (ano/ne)
- DennÃ­ souhrn (ano/ne)

**Funkce:**
- `create_user()` - vytvoÅ™enÃ­ uÅ¾ivatele
- `update_user()` - Ãºprava uÅ¾ivatele
- `delete_user()` - smazÃ¡nÃ­ (pouze pokud nemÃ¡ data)
- `reset_password()` - reset hesla
- `toggle_active()` - aktivace/deaktivace
- `view_activity_log()` - log aktivit uÅ¾ivatele

**BezpeÄnost:**
- Hash hesla (bcrypt)
- DvoufaktorovÃ¡ autentizace (volitelnÄ›)
- Session timeout
- Lockout po X neÃºspÄ›Å¡nÃ½ch pokusech

---

### **5. `settings_permissions.py`** ğŸ”

**ÃšÄel:** SprÃ¡va oprÃ¡vnÄ›nÃ­ a rolÃ­

**Obsahuje:**

**PÅ™eddefinovanÃ© role:**

*AdministrÃ¡tor:*
- âœ… PlnÃ½ pÅ™Ã­stup ke vÅ¡emu
- âœ… SprÃ¡va uÅ¾ivatelÅ¯
- âœ… NastavenÃ­ systÃ©mu
- âœ… ZÃ¡lohovÃ¡nÃ­
- âœ… MazÃ¡nÃ­ dat

*ManaÅ¾er:*
- âœ… ZakÃ¡zky (vÅ¡e)
- âœ… ZÃ¡kaznÃ­ci (vÅ¡e)
- âœ… Vozidla (vÅ¡e)
- âœ… Fakturace (ÄtenÃ­)
- âœ… Reporty (vÅ¡e)
- âŒ SprÃ¡va uÅ¾ivatelÅ¯
- âŒ NastavenÃ­ systÃ©mu

*Mechanik:*
- âœ… ZakÃ¡zky (vlastnÃ­, upravit)
- âœ… ZÃ¡kaznÃ­ci (ÄtenÃ­)
- âœ… Vozidla (ÄtenÃ­)
- âœ… Sklad (vÃ½dej)
- âŒ Fakturace
- âŒ Reporty

*Recepce:*
- âœ… ZakÃ¡zky (vytvoÅ™it, ÄtenÃ­)
- âœ… ZÃ¡kaznÃ­ci (vÅ¡e)
- âœ… Vozidla (vÅ¡e)
- âœ… KalendÃ¡Å™ (vÅ¡e)
- âŒ Sklad
- âŒ Fakturace

*ÃšÄetnÃ­:*
- âœ… Fakturace (vÅ¡e)
- âœ… Reporty finanÄnÃ­
- âœ… ZÃ¡kaznÃ­ci (ÄtenÃ­)
- âŒ ZakÃ¡zky (jen ÄtenÃ­)
- âŒ Sklad

**Matice oprÃ¡vnÄ›nÃ­:**
```
Modul          | Admin | ManaÅ¾er | Mechanik | Recepce | ÃšÄetnÃ­ |
---------------|-------|---------|----------|---------|--------|
ZakÃ¡zky-ÄŒÃ­st   |  âœ…   |   âœ…    |    âœ…    |   âœ…    |   âœ…   |
ZakÃ¡zky-VytvoÅ™it|  âœ…   |   âœ…    |    âŒ    |   âœ…    |   âŒ   |
ZakÃ¡zky-Upravit|  âœ…   |   âœ…    |    âœ…*   |   âŒ    |   âŒ   |
ZakÃ¡zky-Smazat |  âœ…   |   âœ…    |    âŒ    |   âŒ    |   âŒ   |
ZÃ¡kaznÃ­ci-VÅ¡e  |  âœ…   |   âœ…    |    âŒ    |   âœ…    |   âŒ   |
Fakturace-VÅ¡e  |  âœ…   |   âŒ    |    âŒ    |   âŒ    |   âœ…   |
NastavenÃ­      |  âœ…   |   âŒ    |    âŒ    |   âŒ    |   âŒ   |
```
*pouze vlastnÃ­ zakÃ¡zky

**VytvoÅ™enÃ­ vlastnÃ­ role:**
- NÃ¡zev role
- Popis
- VÃ½bÄ›r oprÃ¡vnÄ›nÃ­ (checkbox tree)
- Barva role

**Audit log:**
- Kdo udÄ›lal co a kdy
- FiltrovÃ¡nÃ­ podle uÅ¾ivatele/akce
- Export logu

**Funkce:**
- `create_role()` - novÃ¡ role
- `assign_permissions()` - pÅ™iÅ™azenÃ­ oprÃ¡vnÄ›nÃ­
- `check_permission()` - kontrola oprÃ¡vnÄ›nÃ­
- `view_audit_log()` - audit log

---

### **6. `settings_orders.py`** ğŸ“‹

**ÃšÄel:** NastavenÃ­ zakÃ¡zek

**Obsahuje:**

**Sekce: ÄŒÃ­slovÃ¡nÃ­ zakÃ¡zek**
- FormÃ¡t ÄÃ­sla (RRRR####, ZAK-####, vlastnÃ­)
- Prefix (ZAK-, OBJ-, ...)
- PoÄÃ¡teÄnÃ­ ÄÃ­slo
- Reset kaÅ¾dÃ½ rok (ano/ne)
- NÃ¡hled: ZAK-2025-0001

**Sekce: Typy zakÃ¡zek**
- Seznam typÅ¯ (editovatelnÃ½):
  - ZakÃ¡zka
  - VolnÃ½ prodej
  - NabÃ­dka
  - Garance
  - Reklamace
- PÅ™idÃ¡nÃ­ vlastnÃ­ho typu
- Barva pro kaÅ¾dÃ½ typ

**Sekce: Stavy zakÃ¡zek**
- Seznam stavÅ¯ (editovatelnÃ½):
  - V pÅ™Ã­pravÄ› (Å¡edÃ¡)
  - OtevÅ™enÃ¡ (modrÃ¡)
  - RozpracovanÃ¡ (oranÅ¾ovÃ¡)
  - ÄŒekÃ¡ na dÃ­ly (Å¾lutÃ¡)
  - HotovÃ¡ (zelenÃ¡)
  - FakturovÃ¡no (fialovÃ¡)
  - Archiv (tmavÄ› Å¡edÃ¡)
- Workflow (povolenÃ© pÅ™echody)
- Barva stavu
- Ikona stavu

**Sekce: VÃ½chozÃ­ hodnoty**
- VÃ½chozÃ­ typ zakÃ¡zky
- VÃ½chozÃ­ stav novÃ© zakÃ¡zky
- VÃ½chozÃ­ mechanik (ano/ne)
- Automaticky pÅ™iÅ™adit zÃ¡kaznÃ­ka vozidlu
- Automaticky vypoÄÃ­tat cenu

**Sekce: PoloÅ¾ky zakÃ¡zky**
- Typy poloÅ¾ek:
  - MateriÃ¡l
  - PrÃ¡ce
  - CizÃ­ vÃ½kon
  - OstatnÃ­
- VÃ½chozÃ­ DPH sazba (21%, 15%, 12%, 0%)
- ZaokrouhlovÃ¡nÃ­ cen (na koruny, na 10hal)
- MinimÃ¡lnÃ­ marÅ¾e (varovÃ¡nÃ­)

**Sekce: Automatizace**
- AutomatickÃ© odeslÃ¡nÃ­ emailu zÃ¡kaznÃ­kovi pÅ™i:
  - VytvoÅ™enÃ­ zakÃ¡zky
  - ZmÄ›nÄ› stavu
  - DokonÄenÃ­
- AutomatickÃ½ tisk zakÃ¡zkovÃ©ho listu
- AutomatickÃ¡ archivace po X dnech

---

### **7. `settings_invoicing.py`** ğŸ§¾

**ÃšÄel:** NastavenÃ­ fakturace

**Obsahuje:**

**Sekce: ÄŒÃ­selnÃ© Å™ady**

*Faktury vydanÃ©:*
- FormÃ¡t (FV2025####)
- Prefix (FV-, FAK-, ...)
- PoÄÃ¡teÄnÃ­ ÄÃ­slo
- Reset roÄnÄ›

*Faktury pÅ™ijatÃ©:*
- FormÃ¡t (FP2025####)
- Prefix
- PoÄÃ¡teÄnÃ­ ÄÃ­slo

*Dobropisy:*
- FormÃ¡t (DOP2025####)
- Prefix
- PoÄÃ¡teÄnÃ­ ÄÃ­slo

*ZÃ¡lohovÃ© faktury:*
- FormÃ¡t
- Prefix

**Sekce: Splatnost**
- VÃ½chozÃ­ splatnost (14, 21, 30, 45, 60 dnÃ­)
- RÅ¯znÃ¡ splatnost podle skupiny zÃ¡kaznÃ­ka
- PenÃ¡le z prodlenÃ­ (% dennÄ›)
- Ãšrok z prodlenÃ­

**Sekce: DPH**
- PlÃ¡tce DPH (ano/ne)
- DIÄŒ firmy
- Sazby DPH:
  - ZÃ¡kladnÃ­: 21%
  - SnÃ­Å¾enÃ¡: 12%
  - NulovÃ¡: 0%
- VÃ½chozÃ­ sazba
- ReÅ¾im pÅ™enesenÃ­ daÅˆovÃ© povinnosti

**Sekce: PlatebnÃ­ metody**
- Seznam metod:
  - BankovnÃ­ pÅ™evod
  - Hotovost
  - PlatebnÃ­ karta
  - DobÃ­rka
- VÃ½chozÃ­ metoda
- Poplatky za metodu

**Sekce: ZaokrouhlovÃ¡nÃ­**
- ZaokrouhlovÃ¡nÃ­ faktur (na koruny, 10hal, bez)
- ZaokrouhlovÃ¡nÃ­ DPH
- ZpÅ¯sob zaokrouhlenÃ­ (matematicky, nahoru, dolÅ¯)

**Sekce: UpomÃ­nky**
- 1. upomÃ­nka po X dnech
- 2. upomÃ­nka po Y dnech
- 3. upomÃ­nka po Z dnech
- AutomatickÃ© odesÃ­lÃ¡nÃ­ (ano/ne)
- Å ablona upomÃ­nky

---

### **8. `settings_templates.py`** ğŸ“„

**ÃšÄel:** SprÃ¡va Å¡ablon dokumentÅ¯

**Obsahuje:**

**Seznam Å¡ablon:**
- ğŸ“‹ ZakÃ¡zkovÃ½ list
- ğŸ“Š Proforma
- ğŸ§¾ Faktura
- ğŸ“ NabÃ­dka
- ğŸ“„ Smlouva servisnÃ­
- ğŸ“‹ PÅ™edÃ¡vacÃ­ protokol
- ğŸ“§ Email - potvrzenÃ­ zakÃ¡zky
- ğŸ“§ Email - upomÃ­nka
- ğŸ“§ Email - dokonÄenÃ­
- ğŸ“± SMS Å¡ablony

**Editor Å¡ablon:**

*WYSIWYG editor:*
- FormÃ¡tovÃ¡nÃ­ textu
- VklÃ¡dÃ¡nÃ­ promÄ›nnÃ½ch ({{firma}}, {{zakaznik}}, {{datum}})
- Logo
- Tabulky
- ObrÃ¡zky

*PromÄ›nnÃ© (placeholder):*
```
{{firma_nazev}}
{{firma_ico}}
{{firma_dic}}
{{firma_adresa}}
{{firma_telefon}}
{{firma_email}}
{{firma_ucet}}

{{zakaznik_jmeno}}
{{zakaznik_adresa}}
{{zakaznik_telefon}}
{{zakaznik_email}}
{{zakaznik_ico}}

{{vozidlo_spz}}
{{vozidlo_znacka}}
{{vozidlo_model}}
{{vozidlo_vin}}

{{zakazka_cislo}}
{{zakazka_datum}}
{{zakazka_polozky}}
{{zakazka_cena}}

{{faktura_cislo}}
{{faktura_datum_vystaveni}}
{{faktura_datum_splatnosti}}
{{faktura_vs}}
```

*NÃ¡hled:*
- Live nÃ¡hled s ukÃ¡zkovÃ½mi daty
- PDF nÃ¡hled
- Tisk testovacÃ­

**Import/Export Å¡ablon:**
- Export do souboru
- Import ze souboru
- SdÃ­lenÃ­ Å¡ablon

**Funkce:**
- `edit_template()` - editace Å¡ablony
- `preview_template()` - nÃ¡hled
- `restore_default()` - obnovenÃ­ vÃ½chozÃ­
- `duplicate_template()` - duplikace
- `export_template()` - export

---

### **9. `settings_email.py`** ğŸ“§

**ÃšÄel:** NastavenÃ­ emailu a notifikacÃ­

**Obsahuje:**

**Sekce: SMTP nastavenÃ­**
- SMTP server *
- Port * (587, 465, 25)
- Å ifrovÃ¡nÃ­ (TLS/SSL/Å¾Ã¡dnÃ©)
- UÅ¾ivatelskÃ© jmÃ©no *
- Heslo *
- OdesÃ­latel (From) *
- Reply-To
- TlaÄÃ­tko "ğŸ§ª Test pÅ™ipojenÃ­"

**Sekce: PÅ™ednastavenÃ© SMTP**
- Gmail
- Outlook/Office 365
- Seznam.cz
- VlastnÃ­

**Sekce: AutomatickÃ© emaily**
- PotvrzenÃ­ zakÃ¡zky (ano/ne)
- ZmÄ›na stavu zakÃ¡zky
- DokonÄenÃ­ zakÃ¡zky
- OdeslÃ¡nÃ­ faktury
- UpomÃ­nka pÅ™ed STK
- UpomÃ­nka platby

**Sekce: Podpis emailu**
- HTML podpis
- Logo v podpisu
- KontaktnÃ­ Ãºdaje
- SociÃ¡lnÃ­ sÃ­tÄ›

**Sekce: SMS brÃ¡na (volitelnÄ›)**
- Poskytovatel (SMS Operator, GoSMS...)
- API klÃ­Ä
- OdesÃ­latel
- Kredit (zobrazenÃ­)
- TlaÄÃ­tko "ğŸ§ª Test SMS"

**Sekce: Push notifikace**
- Notifikace v aplikaci (ano/ne)
- Zvuk notifikace
- Desktop notifikace

**Log odeslanÃ½ch emailÅ¯:**
- Datum a Äas
- PÅ™Ã­jemce
- PÅ™edmÄ›t
- Stav (odeslÃ¡no/chyba)
- Detail chyby

---

### **10. `settings_backup.py`** ğŸ’¾

**ÃšÄel:** ZÃ¡lohovÃ¡nÃ­ a obnova dat
moÅ¾nost nastavit si zÃ¡lohu do pc a tÅ™eba na NAS server

**Obsahuje:**

**Sekce: AutomatickÃ© zÃ¡lohovÃ¡nÃ­**
- Povolit automatickÃ© zÃ¡lohy (ano/ne)
- Frekvence:
  - DennÄ›
  - TÃ½dnÄ›
  - MÄ›sÃ­ÄnÄ›
- ÄŒas zÃ¡lohovÃ¡nÃ­ (napÅ™. 23:00)
- MÃ­sto uloÅ¾enÃ­:
  - LokÃ¡lnÃ­ sloÅ¾ka
  - SÃ­Å¥ovÃ½ disk
  - Cloud (Google Drive, OneDrive)
- PoÄet uchovÃ¡vanÃ½ch zÃ¡loh (napÅ™. 30)
- Rotace starÃ½ch zÃ¡loh

**Sekce: ManuÃ¡lnÃ­ zÃ¡loha**
- TlaÄÃ­tko "ğŸ’¾ VytvoÅ™it zÃ¡lohu nynÃ­"
- VÃ½bÄ›r co zÃ¡lohovat:
  - âœ… DatabÃ¡ze
  - âœ… Dokumenty
  - âœ… Fotky
  - âœ… NastavenÃ­
  - âœ… Å ablony
- Progress bar
- Velikost zÃ¡lohy
- ÄŒas trvÃ¡nÃ­

**Sekce: Obnova ze zÃ¡lohy**
- Seznam dostupnÃ½ch zÃ¡loh:
  - Datum a Äas
  - Velikost
  - Typ (auto/manuÃ¡lnÃ­)
  - Obsah
- TlaÄÃ­tko "ğŸ”„ Obnovit"
- VarovÃ¡nÃ­ o pÅ™epsÃ¡nÃ­ dat
- Preview co bude obnoveno

**Sekce: Export dat**
- Export databÃ¡ze (SQL dump)
- Export do CSV
- Export do Excel
- Export do JSON
- SelektivnÃ­ export (pouze zÃ¡kaznÃ­ci, pouze zakÃ¡zky...)

**Sekce: Import dat**
- Import z CSV
- Import ze zÃ¡lohy
- MapovÃ¡nÃ­ dat
- Validace pÅ™ed importem

**Log zÃ¡lohovÃ¡nÃ­:**
- Historie zÃ¡loh
- ÃšspÄ›Å¡nÃ©/neÃºspÄ›Å¡nÃ©
- Velikost
- ÄŒas trvÃ¡nÃ­

**Funkce:**
- `create_backup()` - vytvoÅ™enÃ­ zÃ¡lohy
- `restore_backup()` - obnova
- `schedule_backup()` - naplÃ¡novÃ¡nÃ­
- `cleanup_old_backups()` - smazÃ¡nÃ­ starÃ½ch
- `verify_backup()` - ovÄ›Å™enÃ­ integrity

---

### **11. `settings_database.py`** ğŸ—„ï¸

**ÃšÄel:** SprÃ¡va databÃ¡ze

**Obsahuje:**

**Sekce: Informace o databÃ¡zi**
- Typ databÃ¡ze (SQLite)
- Verze
- Cesta k souboru
- Velikost databÃ¡ze
- PoÄet zÃ¡znamÅ¯:
  - ZÃ¡kaznÃ­ci: 150
  - Vozidla: 230
  - ZakÃ¡zky: 1,450
  - Faktury: 980
- PoslednÃ­ zÃ¡loha
- Stav: âœ… OK

**Sekce: ÃšdrÅ¾ba databÃ¡ze**
- TlaÄÃ­tko "ğŸ”§ Optimalizovat databÃ¡zi" (VACUUM)
- TlaÄÃ­tko "âœ… Kontrola integrity"
- TlaÄÃ­tko "ğŸ”„ Reindex"
- TlaÄÃ­tko "ğŸ—‘ï¸ VyÄistit doÄasnÃ© soubory"

**Sekce: Archivace**
- Archivovat starÃ© zakÃ¡zky (starÅ¡Ã­ neÅ¾ X let)
- Archivovat starÃ© faktury
- PÅ™esun do archivnÃ­ databÃ¡ze
- NastavenÃ­ pravidel archivace

**Sekce: Migrace dat**
- Import z jinÃ©ho systÃ©mu
- Export pro migraci
- FormÃ¡ty (CSV, SQL, JSON)

**Sekce: PokroÄilÃ©**
- SQL konzole (pouze admin)
- Spustit vlastnÃ­ dotaz
- Zobrazit strukturu tabulek
- Log chyb databÃ¡ze

**VarovÃ¡nÃ­:**
- âš ï¸ Tyto operace mohou bÃ½t nevratnÃ©!
- âš ï¸ VytvoÅ™te zÃ¡lohu pÅ™ed zmÄ›nami!

---

### **12. `settings_appearance.py`** ğŸ¨

**ÃšÄel:** Vzhled a pÅ™izpÅ¯sobenÃ­

**Obsahuje:**

**Sekce: TÃ©ma aplikace**
- SvÄ›tlÃ© tÃ©ma
- TmavÃ© tÃ©ma
- Automaticky podle systÃ©mu
- VlastnÃ­ barvy

**Sekce: Barvy**
- PrimÃ¡rnÃ­ barva (picker)
- SekundÃ¡rnÃ­ barva
- Barva ÃºspÄ›chu (zelenÃ¡)
- Barva varovÃ¡nÃ­ (oranÅ¾ovÃ¡)
- Barva chyby (ÄervenÃ¡)
- Barva pozadÃ­
- Barva textu

**Sekce: PÃ­smo**
- Font aplikace (Roboto, Arial, Segoe UI...)
- Velikost pÃ­sma (malÃ©, stÅ™ednÃ­, velkÃ©)
- TuÄnÃ© nadpisy (ano/ne)

**Sekce: Layout**
- KompaktnÃ­ reÅ¾im (menÅ¡Ã­ mezery)
- Zobrazit ikony (ano/ne)
- Zobrazit popisky tlaÄÃ­tek
- Å Ã­Å™ka postrannÃ­ho menu
- VÃ½chozÃ­ modul po pÅ™ihlÃ¡Å¡enÃ­

**Sekce: Dashboard**
- Widgety na dashboardu (drag & drop poÅ™adÃ­):
  - DneÅ¡nÃ­ zakÃ¡zky
  - Statistiky
  - VytÃ­Å¾enost
  - UpozornÄ›nÃ­
  - RychlÃ© akce
- PoÄet sloupcÅ¯ (1-3)
- AutomatickÃ© obnovovÃ¡nÃ­ (interval)

**Sekce: Tabulky**
- Å˜Ã¡dkÅ¯ na strÃ¡nku (10, 25, 50, 100)
- AlternujÃ­cÃ­ barvy Å™Ã¡dkÅ¯
- ZvÃ½razÅˆovat pÅ™i hover
- KompaktnÃ­ Å™Ã¡dky

**Sekce: Jazyk**
- Jazyk aplikace (ÄŒeÅ¡tina, English...)
- FormÃ¡t data (DD.MM.YYYY, YYYY-MM-DD)
- FormÃ¡t Äasu (24h, 12h AM/PM)
- OddÄ›lovaÄ tisÃ­cÅ¯ (mezera, teÄka, ÄÃ¡rka)
- DesetinnÃ½ oddÄ›lovaÄ (ÄÃ¡rka, teÄka)
- MÄ›na (CZK, EUR, USD)

**NÃ¡hled:**
- Live nÃ¡hled zmÄ›n
- TlaÄÃ­tko "PouÅ¾Ã­t"
- TlaÄÃ­tko "Obnovit vÃ½chozÃ­"

---

### **13. `settings_integrations.py`** ğŸ”—

**ÃšÄel:** Integrace s externÃ­mi sluÅ¾bami

**Obsahuje:**

**Sekce: ARES (ObchodnÃ­ rejstÅ™Ã­k)**
- Povolit ARES lookup (ano/ne)
- AutomatickÃ© doplnÄ›nÃ­ firemnÃ­ch ÃºdajÅ¯
- Cache vÃ½sledkÅ¯ (dny)

**Sekce: Google Calendar**
- PÅ™ipojit Google ÃºÄet
- OAuth autentizace
- Synchronizovat kalendÃ¡Å™ (ano/ne)
- SmÄ›r synchronizace (obousmÄ›rnÄ›, pouze export)
- KalendÃ¡Å™ pro synchronizaci

**Sekce: Outlook/Microsoft 365**
- PÅ™ipojit Microsoft ÃºÄet
- Synchronizace kalendÃ¡Å™e
- Synchronizace emailÅ¯

**Sekce: ÃšÄetnÃ­ systÃ©my**
- Pohoda (export XML)
- Money S3 (export)
- ABRA (API)
- FormÃ¡t exportu
- AutomatickÃ½ export

**Sekce: PlatebnÃ­ brÃ¡ny**
- QR platba (generovÃ¡nÃ­ QR kÃ³du)
- GoPay (volitelnÄ›)
- PayPal (volitelnÄ›)

**Sekce: SMS brÃ¡na**
- Poskytovatel
- API klÃ­Ä
- Test SMS

**Sekce: API pÅ™Ã­stup**
- Povolit API (ano/ne)
- API klÃ­Ä (generovÃ¡nÃ­)
- Rate limiting
- PovolenÃ© IP adresy
- Dokumentace API

**Sekce: Webhooks**
- URL pro webhook
- UdÃ¡losti k odesÃ­lÃ¡nÃ­:
  - NovÃ¡ zakÃ¡zka
  - ZmÄ›na stavu
  - NovÃ¡ faktura
- TestovÃ¡nÃ­ webhook

---

### **14. `settings_license.py`** ğŸ“œ

**ÃšÄel:** Licence a aktivace

**Obsahuje:**

**Sekce: Informace o licenci**
- Typ licence (Trial, Basic, Pro, Enterprise)
- LicenÄnÃ­ klÃ­Ä
- Platnost do
- ZbÃ½vÃ¡ dnÃ­
- Stav: âœ… AktivnÃ­ / âš ï¸ Expiruje / âŒ NeplatnÃ¡

**Sekce: Limity licence**
- PoÄet uÅ¾ivatelÅ¯: 5/5
- PoÄet zÃ¡kaznÃ­kÅ¯: Neomezeno
- PoÄet vozidel: Neomezeno
- Moduly:
  - âœ… ZakÃ¡zky
  - âœ… ZÃ¡kaznÃ­ci
  - âœ… Vozidla
  - âœ… Sklad
  - âœ… Fakturace
  - âš ï¸ PokroÄilÃ© reporty (Pro)
  - âŒ API pÅ™Ã­stup (Enterprise)

**Sekce: Aktivace**
- LicenÄnÃ­ klÃ­Ä (input)
- TlaÄÃ­tko "ğŸ”‘ Aktivovat"
- Online aktivace
- Offline aktivace (soubor)

**Sekce: Upgrade**
- AktuÃ¡lnÃ­ plÃ¡n
- DostupnÃ© plÃ¡ny:
  - Basic: 499 KÄ/mÄ›sÃ­c
  - Pro: 999 KÄ/mÄ›sÃ­c
  - Enterprise: Kontaktujte nÃ¡s
- TlaÄÃ­tko "â¬†ï¸ Upgradovat"

**Sekce: O aplikaci**
- NÃ¡zev: Motoservis DMS
- Verze: 2.0.0
- Build: 2025.11.14
- VÃ½vojÃ¡Å™: [VaÅ¡e firma]
- Kontakt: support@...
- TlaÄÃ­tko "ğŸ”„ Zkontrolovat aktualizace"

**Sekce: PrÃ¡vnÃ­ informace**
- EULA (licence)
- Ochrana osobnÃ­ch ÃºdajÅ¯
- GDPR
- PodmÃ­nky pouÅ¾itÃ­

---

### **15. `settings_widgets.py`** ğŸ§©

**ÃšÄel:** PomocnÃ© dialogy a komponenty

**Obsahuje:**

**`SettingsSection`:**
- Kontejner pro sekci nastavenÃ­
- Nadpis s ikonou
- Obsah
- TlaÄÃ­tko uloÅ¾it
- IndikÃ¡tor zmÄ›n

**`ColorPickerWidget`:**
- VÃ½bÄ›r barvy
- Hex input
- RGB sliders
- PÅ™ednastavenÃ© barvy
- NÃ¡hled

**`FontSelectorWidget`:**
- VÃ½bÄ›r fontu
- Velikost
- NÃ¡hled textu

**`FilePathSelector`:**
- VÃ½bÄ›r cesty k souboru/sloÅ¾ce
- Browse tlaÄÃ­tko
- Validace existence

**`PasswordChangeDialog`:**
- StarÃ© heslo
- NovÃ© heslo
- PotvrzenÃ­ hesla
- IndikÃ¡tor sÃ­ly hesla

**`ImportExportDialog`:**
- VÃ½bÄ›r formÃ¡tu
- MapovÃ¡nÃ­ sloupcÅ¯
- Preview
- Progress bar

**`TestConnectionDialog`:**
- Test SMTP
- Test SMS
- Test API
- VÃ½sledek (ÃºspÄ›ch/chyba)

**`BackupProgressDialog`:**
- Progress bar
- AktuÃ¡lnÃ­ operace
- ÄŒas zbÃ½vajÃ­cÃ­
- ZruÅ¡it tlaÄÃ­tko

**`LicenseActivationDialog`:**
- Input pro klÃ­Ä
- Online/Offline aktivace
- VÃ½sledek aktivace

**`AboutDialog`:**
- Logo aplikace
- Verze
- Copyright
- Licence
- Kontakt
- Credits

---

## ğŸ¨ VIZUALIZACE STRUKTURY

```
âš™ï¸ MODUL NASTAVENÃ
â”‚
â”œâ”€ ğŸ¢ FiremnÃ­ Ãºdaje (settings_company)
â”‚  â”œâ”€ ğŸ“‹ ZÃ¡kladnÃ­ Ãºdaje (IÄŒO, DIÄŒ)
â”‚  â”œâ”€ ğŸ“ KontaktnÃ­ Ãºdaje
â”‚  â”œâ”€ ğŸ¦ BankovnÃ­ spojenÃ­
â”‚  â”œâ”€ ğŸ¨ Logo a branding
â”‚  â””â”€ ğŸ• ProvoznÃ­ Ãºdaje
â”‚
â”œâ”€ ğŸ‘¥ UÅ¾ivatelÃ© (settings_users)
â”‚  â”œâ”€ ğŸ“‹ Seznam uÅ¾ivatelÅ¯
â”‚  â”œâ”€ â• NovÃ½ uÅ¾ivatel
â”‚  â”œâ”€ ğŸ” Hesla a zabezpeÄenÃ­
â”‚  â””â”€ ğŸ“Š Log aktivit
â”‚
â”œâ”€ ğŸ” OprÃ¡vnÄ›nÃ­ (settings_permissions)
â”‚  â”œâ”€ ğŸ‘” Role (Admin, ManaÅ¾er...)
â”‚  â”œâ”€ âœ… Matice oprÃ¡vnÄ›nÃ­
â”‚  â”œâ”€ â• VlastnÃ­ role
â”‚  â””â”€ ğŸ“‹ Audit log
â”‚
â”œâ”€ ğŸ“‹ ZakÃ¡zky (settings_orders)
â”‚  â”œâ”€ ğŸ”¢ ÄŒÃ­slovÃ¡nÃ­
â”‚  â”œâ”€ ğŸ“Š Typy zakÃ¡zek
â”‚  â”œâ”€ ğŸ”„ Stavy a workflow
â”‚  â””â”€ âš™ï¸ VÃ½chozÃ­ hodnoty
â”‚
â”œâ”€ ğŸ§¾ Fakturace (settings_invoicing)
â”‚  â”œâ”€ ğŸ”¢ ÄŒÃ­selnÃ© Å™ady
â”‚  â”œâ”€ ğŸ“… Splatnosti
â”‚  â”œâ”€ ğŸ’° DPH sazby
â”‚  â””â”€ ğŸ“§ UpomÃ­nky
â”‚
â”œâ”€ ğŸ“„ Å ablony (settings_templates)
â”‚  â”œâ”€ ğŸ“‹ Seznam Å¡ablon
â”‚  â”œâ”€ âœï¸ WYSIWYG editor
â”‚  â”œâ”€ ğŸ”¤ PromÄ›nnÃ©
â”‚  â””â”€ ğŸ‘ï¸ NÃ¡hled
â”‚
â”œâ”€ ğŸ“§ Email (settings_email)
â”‚  â”œâ”€ ğŸ“® SMTP nastavenÃ­
â”‚  â”œâ”€ ğŸ“¨ AutomatickÃ© emaily
â”‚  â”œâ”€ âœï¸ Podpis
â”‚  â””â”€ ğŸ“± SMS brÃ¡na
â”‚
â”œâ”€ ğŸ’¾ ZÃ¡lohovÃ¡nÃ­ (settings_backup)
â”‚  â”œâ”€ â° AutomatickÃ© zÃ¡lohy
â”‚  â”œâ”€ ğŸ’¾ ManuÃ¡lnÃ­ zÃ¡loha
â”‚  â”œâ”€ ğŸ”„ Obnova
â”‚  â””â”€ ğŸ“¤ Export/Import
â”‚
â”œâ”€ ğŸ—„ï¸ DatabÃ¡ze (settings_database)
â”‚  â”œâ”€ â„¹ï¸ Informace
â”‚  â”œâ”€ ğŸ”§ ÃšdrÅ¾ba
â”‚  â”œâ”€ ğŸ“¦ Archivace
â”‚  â””â”€ ğŸ”„ Migrace
â”‚
â”œâ”€ ğŸ¨ Vzhled (settings_appearance)
â”‚  â”œâ”€ ğŸŒ“ TÃ©ma (svÄ›tlÃ©/tmavÃ©)
â”‚  â”œâ”€ ğŸ¨ Barvy
â”‚  â”œâ”€ ğŸ”¤ PÃ­smo
â”‚  â””â”€ ğŸŒ Jazyk a formÃ¡ty
â”‚
â”œâ”€ ğŸ”— Integrace (settings_integrations)
â”‚  â”œâ”€ ğŸ” ARES
â”‚  â”œâ”€ ğŸ“… Google/Outlook Calendar
â”‚  â”œâ”€ ğŸ’° ÃšÄetnÃ­ systÃ©my
â”‚  â””â”€ ğŸ”Œ API
â”‚
â””â”€ ğŸ“œ Licence (settings_license)
   â”œâ”€ ğŸ”‘ Aktivace
   â”œâ”€ ğŸ“Š Limity
   â”œâ”€ â¬†ï¸ Upgrade
   â””â”€ â„¹ï¸ O aplikaci
```

---

## ğŸ”— VAZBY NA OSTATNÃ MODULY

**ZÃ¡visÃ­ na:**
- `config` - vÃ½chozÃ­ hodnoty
- `database_manager` - pÅ™Ã­stup k databÃ¡zi

**PouÅ¾Ã­vÃ¡ ho:**
- VÅ¡echny ostatnÃ­ moduly (ÄtenÃ­ nastavenÃ­)
- CelÃ¡ aplikace (barvy, formÃ¡ty, oprÃ¡vnÄ›nÃ­)

**DatabÃ¡zovÃ© tabulky:**
- `settings` - klÃ­Ä-hodnota nastavenÃ­
- `users` - uÅ¾ivatelÃ©
- `roles` - role
- `permissions` - oprÃ¡vnÄ›nÃ­
- `templates` - Å¡ablony dokumentÅ¯
- `audit_log` - log zmÄ›n
- `backups` - historie zÃ¡loh

---

## ğŸ’¾ DATABÃZOVÃ STRUKTURA

```sql
CREATE TABLE settings (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    category TEXT NOT NULL,
    key TEXT NOT NULL,
    value TEXT,
    value_type TEXT DEFAULT 'string', -- string/integer/boolean/json
    description TEXT,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_by INTEGER,
    UNIQUE(category, key)
);

CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username TEXT UNIQUE NOT NULL,
    password_hash TEXT NOT NULL,
    first_name TEXT NOT NULL,
    last_name TEXT NOT NULL,
    email TEXT UNIQUE NOT NULL,
    phone TEXT,
    role_id INTEGER NOT NULL,
    is_active BOOLEAN DEFAULT 1,
    last_login DATETIME,
    failed_attempts INTEGER DEFAULT 0,
    locked_until DATETIME,
    must_change_password BOOLEAN DEFAULT 0,
    two_factor_enabled BOOLEAN DEFAULT 0,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (role_id) REFERENCES roles(id)
);

CREATE TABLE roles (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT UNIQUE NOT NULL,
    description TEXT,
    is_system BOOLEAN DEFAULT 0, -- systÃ©movÃ© role nelze smazat
    color TEXT DEFAULT '#95a5a6',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE role_permissions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    role_id INTEGER NOT NULL,
    module TEXT NOT NULL,
    action TEXT NOT NULL, -- read/create/update/delete
    allowed BOOLEAN DEFAULT 0,
    FOREIGN KEY (role_id) REFERENCES roles(id),
    UNIQUE(role_id, module, action)
);

CREATE TABLE audit_log (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER,
    action TEXT NOT NULL,
    module TEXT,
    record_id INTEGER,
    old_value TEXT,
    new_value TEXT,
    ip_address TEXT,
    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

CREATE TABLE templates (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    type TEXT NOT NULL, -- invoice/order/email/sms
    subject TEXT,
    content TEXT NOT NULL,
    variables TEXT, -- JSON array of available variables
    is_default BOOLEAN DEFAULT 0,
    active BOOLEAN DEFAULT 1,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE backups (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    file_name TEXT NOT NULL,
    file_path TEXT NOT NULL,
    file_size INTEGER,
    backup_type TEXT DEFAULT 'manual', -- manual/auto
    contents TEXT, -- JSON: ["database", "documents", "photos"]
    status TEXT DEFAULT 'completed',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    created_by INTEGER
);

-- Indexy
CREATE INDEX idx_settings_category ON settings(category);
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_audit_log_user ON audit_log(user_id);
CREATE INDEX idx_audit_log_timestamp ON audit_log(timestamp);
```

---

## ğŸ’¡ KLÃÄŒOVÃ‰ FUNKCE

1. **CentrÃ¡lnÃ­ konfigurace** - vÅ¡e na jednom mÃ­stÄ›
2. **SprÃ¡va uÅ¾ivatelÅ¯** - role a oprÃ¡vnÄ›nÃ­
3. **Matice oprÃ¡vnÄ›nÃ­** - granulÃ¡rnÃ­ kontrola pÅ™Ã­stupu
4. **SMTP nastavenÃ­** - emaily a notifikace
5. **AutomatickÃ© zÃ¡lohovÃ¡nÃ­** - ochrana dat
6. **Å ablony dokumentÅ¯** - pÅ™izpÅ¯sobitelnÃ© dokumenty
7. **ÄŒÃ­selnÃ© Å™ady** - automatickÃ© ÄÃ­slovÃ¡nÃ­
8. **DPH nastavenÃ­** - rÅ¯znÃ© sazby
9. **Integrace** - ARES, Calendar, ÃºÄetnÃ­ systÃ©my
10. **Audit log** - sledovÃ¡nÃ­ zmÄ›n
11. **TÃ©mata a pÅ™izpÅ¯sobenÃ­** - personalizace vzhledu
12. **Licence** - sprÃ¡va pÅ™edplatnÃ©ho
13. **Database maintenance** - optimalizace
14. **Export/Import** - migrace dat

---

## ğŸ¯ PRODUKÄŒNÃ POÅ½ADAVKY

1. **BezpeÄnost:**
   - HashovÃ¡nÃ­ hesel (bcrypt, Argon2)
   - SQL injection ochrana
   - XSS ochrana
   - CSRF tokeny
   - Session management
   - Audit logging
   - Å ifrovÃ¡nÃ­ citlivÃ½ch dat

2. **Validace:**
   - Kontrola vÅ¡ech vstupÅ¯
   - FormÃ¡t IÄŒO/DIÄŒ/IBAN
   - Email validace
   - Heslo poÅ¾adavky
   - File upload validace

3. **ZÃ¡lohovÃ¡nÃ­:**
   - AutomatickÃ© zÃ¡lohy
   - Rotace zÃ¡loh
   - OvÄ›Å™enÃ­ integrity
   - Obnova dat
   - Offsite zÃ¡lohy

4. **OprÃ¡vnÄ›nÃ­:**
   - Role-based access control (RBAC)
   - GranulÃ¡rnÃ­ oprÃ¡vnÄ›nÃ­
   - Princip nejmenÅ¡Ã­ch oprÃ¡vnÄ›nÃ­
   - Audit trail

5. **UX:**
   - IntuitivnÃ­ navigace
   - Validace v reÃ¡lnÃ©m Äase
   - NÃ¡povÄ›da a dokumentace
   - Undo zmÄ›n
   - Preview pÅ™ed uloÅ¾enÃ­m

6. **VÃ½kon:**
   - Cache nastavenÃ­
   - Lazy loading
   - OptimalizovanÃ© dotazy
   - Indexy v DB

7. **ÃšdrÅ¾ba:**
   - AutomatickÃ© ÄiÅ¡tÄ›nÃ­
   - Log rotace
   - Archivace dat
   - Health checks
